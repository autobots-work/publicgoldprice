<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Silver Price — publicgoldprice.com</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:        #0a0a0f;
      --surface:   #13131c;
      --surface2:  #1c1c2a;
      --border:    #2a2a3d;
      --border2:   #3a3a55;
      --white:     #f0f2ff;
      --muted:     #6b6b8a;
      --muted2:    #9494b8;
      --gold:      #e2b96f;
      --up:        #3dd68c;
      --up-bg:     rgba(61,214,140,0.12);
      --down:      #ff5f5f;
      --down-bg:   rgba(255,95,95,0.12);
      --flat-bg:   rgba(255,255,255,0.06);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--white);
      min-height: 100vh;
    }

    /* ── TOPBAR ── */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10,10,15,0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 1.5rem;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .topbar-logo {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1rem;
      letter-spacing: -0.3px;
    }

    .topbar-logo span { color: var(--gold); }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .refresh-txt {
      font-size: 0.65rem;
      color: var(--muted);
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      background: var(--up-bg);
      border: 1px solid rgba(61,214,140,0.25);
      color: var(--up);
      font-size: 0.65rem;
      font-weight: 500;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 20px;
    }

    .live-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--up);
      animation: blink 1.4s ease-in-out infinite;
    }

    @keyframes blink {
      0%,100% { opacity:1; }
      50% { opacity:0.2; }
    }

    /* ── MAIN ── */
    main {
      max-width: 860px;
      margin: 0 auto;
      padding: 2rem 1.5rem 5rem;
    }

    /* ── HERO ── */
    .hero {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
      animation: fadeUp 0.4s ease both;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--border2) 30%, #6060cc 60%, transparent);
    }

    .hero-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .hero-label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--muted2);
      margin-bottom: 0.6rem;
    }

    .hero-price-wrap {
      display: flex;
      align-items: baseline;
      gap: 0.35rem;
    }

    .hero-currency {
      font-family: 'Outfit', sans-serif;
      font-size: 1.6rem;
      font-weight: 600;
      color: var(--muted2);
    }

    .hero-price {
      font-family: 'Outfit', sans-serif;
      font-size: 4rem;
      font-weight: 800;
      color: var(--white);
      line-height: 1;
      letter-spacing: -2px;
    }

    .hero-unit {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .hero-change-wrap { text-align: right; }

    .hero-change {
      font-family: 'Outfit', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .hero-change.up   { color: var(--up); }
    .hero-change.down { color: var(--down); }
    .hero-change.flat { color: var(--muted2); }

    .hero-change-sub {
      font-size: 0.68rem;
      color: var(--muted);
      margin-top: 4px;
      letter-spacing: 0.5px;
    }

    .hero-stats {
      display: flex;
      gap: 0;
      border-top: 1px solid var(--border);
      padding-top: 1.25rem;
      flex-wrap: wrap;
      gap: 0.5rem 0;
    }

    .stat {
      flex: 1;
      min-width: 80px;
      padding-right: 1rem;
    }

    .stat + .stat {
      padding-left: 1rem;
      border-left: 1px solid var(--border);
    }

    .stat-label {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--muted);
      margin-bottom: 5px;
    }

    .stat-val {
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--white);
    }

    .stat-val.up   { color: var(--up); }
    .stat-val.down { color: var(--down); }

    /* ── DATE SECTION ── */
    .date-section {
      margin-bottom: 1.5rem;
      animation: fadeUp 0.4s ease both;
    }

    @keyframes fadeUp {
      from { opacity:0; transform:translateY(14px); }
      to   { opacity:1; transform:translateY(0); }
    }

    .date-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .date-pill {
      font-family: 'Outfit', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      padding: 4px 12px;
      border-radius: 20px;
      white-space: nowrap;
    }

    .date-pill.today {
      background: rgba(226,185,111,0.15);
      color: var(--gold);
      border: 1px solid rgba(226,185,111,0.3);
    }

    .date-pill.past {
      background: var(--surface2);
      color: var(--muted2);
      border: 1px solid var(--border);
    }

    .date-line { flex:1; height:1px; background: var(--border); }

    .date-full {
      font-size: 0.65rem;
      color: var(--muted);
      white-space: nowrap;
    }

    /* ── TABLE ── */
    .table-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }

    table { width: 100%; border-collapse: collapse; }

    thead tr {
      background: var(--surface2);
      border-bottom: 1px solid var(--border2);
    }

    th {
      padding: 10px 16px;
      text-align: left;
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 1.8px;
      color: var(--muted2);
      font-weight: 400;
    }

    th.right { text-align: right; }

    td {
      padding: 14px 16px;
      border-top: 1px solid var(--border);
      vertical-align: middle;
    }

    tbody tr:hover td { background: rgba(255,255,255,0.02); }

    .td-time {
      color: var(--muted2);
      font-size: 0.82rem;
      white-space: nowrap;
    }

    .td-price {
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      font-size: 1.05rem;
      color: var(--white);
      white-space: nowrap;
    }

    .td-price .mobile-change {
      display: none;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.72rem;
      font-weight: 400;
      margin-top: 3px;
    }

    .td-change { text-align: right; }

    /* ── BADGE ── */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.72rem;
      font-weight: 500;
      white-space: nowrap;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .badge.up   { background: var(--up-bg);   color: var(--up);   }
    .badge.down { background: var(--down-bg);  color: var(--down); }
    .badge.flat { background: var(--flat-bg);  color: var(--muted2); }

    .badge-pct { font-size: 0.65rem; opacity: 0.8; }

    /* ── FOOTER ── */
    footer {
      text-align: center;
      font-size: 0.65rem;
      color: var(--muted);
      letter-spacing: 1px;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      margin-top: 3rem;
    }

    .empty {
      text-align: center;
      padding: 4rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* ── MOBILE ── */
    @media (max-width: 600px) {
      main { padding: 1.25rem 1rem 4rem; }

      .hero { padding: 1.25rem; border-radius: 12px; margin-bottom: 1.5rem; }
      .hero-price { font-size: 3rem; letter-spacing: -1.5px; }
      .hero-currency { font-size: 1.2rem; }
      .hero-change { font-size: 1.2rem; }

      /* On mobile: hide the desktop change column */
      .desktop-only { display: none !important; }

      /* Show inline change under price */
      .td-price .mobile-change { display: none; }

      th, td { padding: 12px 12px; }
      .td-price { font-size: 0.95rem; }

      .stat-val { font-size: 0.88rem; }
      .stat { min-width: 70px; }

      .date-full { display: none; }
    }
  </style>
</head>
<body>

<div class="topbar">
  <div class="topbar-logo">Public<span>Gold</span>Price</div>

</div>

<main>
  <div id="content"><div class="empty">Loading…</div></div>
  <div style="margin-top:3rem;padding:1.25rem 1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:1.5rem">
    <p style="font-size:0.72rem;color:var(--muted2);line-height:1.7;margin-bottom:0.75rem">The Silver data and prices displayed on this website are based on the latest official prices from Public Gold Malaysia under the SILVER Accumulation Program (999). Prices are subject to change without prior notice.</p>
    <p style="font-size:0.72rem;color:var(--muted);line-height:1.7;font-style:italic">Data dan harga Silver yang dipaparkan di laman ini adalah berdasarkan harga rasmi terkini daripada Public Gold Malaysia di bawah SILVER Accumulation Program (999). Harga adalah tertakluk kepada perubahan semasa tanpa notis.</p>
  </div>
  <footer>
    publicgoldprice.com · Silver Price (RM/g) · Refreshes every 30s · Updated: <span id="last-updated">—</span>
  </footer>
</main>

<script>
  const SHEET_ID   = '1nct9s5DQAzU1ql7h3p3Or8YPUZFRuYdnjawcYkKmojM';
  const REFRESH_MS = 30_000;

  let countdown = REFRESH_MS / 1000;
  setInterval(() => {
    countdown--;
    if (countdown <= 0) countdown = REFRESH_MS / 1000;
    const el = document.getElementById('countdown-txt');
    if (el) el.textContent = 'Refresh in ' + countdown + 's';
  }, 1000);

  // ── Utils ─────────────────────────────────
  function parseGDate(val) {
    if (!val) return null;
    const s = String(val);
    const gd = s.match(/Date\((\d+),(\d+),(\d+)\)/);
    if (gd) return new Date(+gd[1], +gd[2], +gd[3]);
    const dmy = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
    if (dmy) return new Date(+dmy[3], +dmy[2] - 1, +dmy[1]);
    const iso = new Date(s);
    return isNaN(iso) ? null : iso;
  }

  function isToday(d) {
    const n = new Date();
    return d.getFullYear()===n.getFullYear() && d.getMonth()===n.getMonth() && d.getDate()===n.getDate();
  }

  function fmtDate(d) {
    return d.toLocaleDateString('en-GB', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
  }

  function fmtShort(d) {
    return d.toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' });
  }

  function fmtPrice(p) {
    return p.toLocaleString('en-MY', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
  }

  // ── CSV ───────────────────────────────────
  function parseCSV(text) {
    return text.trim().split('\n').slice(1).map(line => {
      const cols = []; let cur = '', inQ = false;
      for (const ch of line) {
        if (ch === '"') inQ = !inQ;
        else if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; }
        else cur += ch;
      }
      cols.push(cur.trim());
      return cols;
    });
  }

  async function fetchData() {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=36921757`;
    const text = await (await fetch(url)).text();
    return parseCSV(text)
      .filter(r => r[0])
      .map(r => ({ date: parseGDate(r[0]), time: r[1] ?? '', price: parseFloat(r[2]) }))
      .filter(r => r.date && !isNaN(r.price))
      .sort((a,b) => b.date - a.date || b.time.localeCompare(a.time));
  }

  // ── Badges ───────────────────────────────
  function badge(curr, prev) {
    if (prev == null) return '<span class="badge flat">—</span>';
    const diff = curr - prev, pct = ((diff/prev)*100).toFixed(2);
    if (diff > 0) return `<span class="badge up">▲ RM ${fmtPrice(diff)} <span class="badge-pct">+${pct}%</span></span>`;
    if (diff < 0) return `<span class="badge down">▼ RM ${fmtPrice(Math.abs(diff))} <span class="badge-pct">${pct}%</span></span>`;
    return '<span class="badge flat">No change</span>';
  }

  function mobileChange(curr, prev) {
    if (prev == null) return '';
    const diff = curr - prev, pct = ((diff/prev)*100).toFixed(2);
    if (diff > 0) return `<span class="mobile-change" style="color:var(--up)">▲ RM ${fmtPrice(diff)} (+${pct}%)</span>`;
    if (diff < 0) return `<span class="mobile-change" style="color:var(--down)">▼ RM ${fmtPrice(Math.abs(diff))} (${pct}%)</span>`;
    return `<span class="mobile-change" style="color:var(--muted2)">No change</span>`;
  }

  // ── Group ─────────────────────────────────
  function groupByDate(records) {
    const map = {};
    records.forEach(r => {
      const k = r.date.toDateString();
      if (!map[k]) map[k] = { date: r.date, entries: [] };
      map[k].entries.push(r);
    });
    return Object.values(map).sort((a,b) => b.date - a.date);
  }

  // ── Render ────────────────────────────────
  function render(records) {
    if (!records.length) {
      document.getElementById('content').innerHTML = '<div class="empty">No data found.</div>';
      return;
    }

    const groups = groupByDate(records);
    let html = '';

    groups.forEach((group, gi) => {
      const today   = isToday(group.date);
      const entries = group.entries;
      const latest  = entries[0];
      const oldest  = entries[entries.length - 1];

      if (today && gi === 0) {
        const dayDiff  = entries.length > 1 ? latest.price - oldest.price : null;
        const dayPct   = dayDiff != null ? ((dayDiff / oldest.price) * 100).toFixed(2) : null;
        const high     = Math.max(...entries.map(e => e.price));
        const low      = Math.min(...entries.map(e => e.price));

        let changeClass = 'flat', changeStr = '—', changeSub = 'first entry today';
        if (dayDiff != null) {
          if (dayDiff > 0)      { changeClass='up';   changeStr=`+RM ${fmtPrice(dayDiff)}`; changeSub=`+${dayPct}% today`; }
          else if (dayDiff < 0) { changeClass='down';  changeStr=`-RM ${fmtPrice(Math.abs(dayDiff))}`; changeSub=`${dayPct}% today`; }
          else                  { changeStr='No change'; changeSub='flat today'; }
        }

        html += `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:0.6rem;margin-bottom:0.6rem">
          <div style="font-family:'Outfit',sans-serif;font-weight:800;font-size:2.2rem;letter-spacing:6px;color:#c8cdd6;line-height:1;text-transform:uppercase">SILVER</div>
          <div style="display:flex;align-items:center;gap:0.6rem">
            <span style="font-size:0.65rem;color:var(--muted);font-family:'JetBrains Mono',monospace" id="countdown-txt">30s</span>
            <div class="live-badge"><span class="live-dot"></span> Live</div>
          </div>
        </div>
        <div class="hero">
          <div class="hero-top">
            <div>
              <div class="hero-label">Silver Latest Price</div>
              <div class="hero-price-wrap">
                <span class="hero-currency">RM</span>
                <span class="hero-price">${fmtPrice(latest.price)}</span>
                <span class="hero-unit">/ 100 gram</span>
              </div>
            </div>
            <div class="hero-change-wrap">
              <div class="hero-change ${changeClass}">${changeStr}</div>
              <div class="hero-change-sub" style="color:${changeClass==='up'?'var(--up)':changeClass==='down'?'var(--down)':'var(--muted)'}">${changeSub}</div>
            </div>
          </div>
          <div class="hero-stats">
            <div class="stat">
              <div class="stat-label">Last Updated</div>
              <div class="stat-val">${latest.time || '—'}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Entries Today</div>
              <div class="stat-val">${entries.length}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Day High</div>
              <div class="stat-val up">RM ${fmtPrice(high)}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Day Low</div>
              <div class="stat-val down">RM ${fmtPrice(low)}</div>
            </div>
          </div>
        </div>`;
      }

      // ── Simple note after hero ──
      if (today && gi === 0) {
        html += `
        <p style="font-size:0.72rem;color:var(--muted2);line-height:1.7;margin-bottom:1.75rem">All prices are based on <a href="https://publicgold.com.my/" target="_blank" rel="noopener" style="color:var(--gold);text-decoration:none;border-bottom:1px solid rgba(226,185,111,0.4)">Public Gold Malaysia SAP 999</a> rates and are subject to change.</p>`;
      }

      const pillClass = today ? 'today' : 'past';
      const pillLabel = today ? 'Today' : fmtShort(group.date);

      html += `
      <div class="date-section" style="animation-delay:${gi*0.05}s">
        <div class="date-row">
          <div class="date-pill ${pillClass}">${pillLabel}</div>
          <div class="date-line"></div>
          ${!today ? `<span class="date-full">${fmtDate(group.date)}</span>` : ''}
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Time</th>
                <th>PRICE / 100 g</th>
                <th class="right">Change</th>
              </tr>
            </thead>
            <tbody>`;

      entries.forEach((e, i) => {
        const prev = entries[i+1]?.price ?? null;
        html += `
              <tr>
                <td class="td-time">${e.time || '—'}</td>
                <td class="td-price">RM ${fmtPrice(e.price)}${mobileChange(e.price, prev)}</td>
                <td class="td-change">${badge(e.price, prev)}</td>
              </tr>`;
      });

      html += `</tbody></table></div></div>`;
    });

    document.getElementById('content').innerHTML = html;
    document.getElementById('last-updated').textContent = new Date().toLocaleTimeString('en-GB');
  }

  async function refresh() {
    countdown = REFRESH_MS / 1000;
    try { render(await fetchData()); }
    catch(e) { console.error(e); document.getElementById('last-updated').textContent = 'Error — retrying…'; }
  }

  refresh();
  setInterval(refresh, REFRESH_MS);
</script>
</body>
</html>
